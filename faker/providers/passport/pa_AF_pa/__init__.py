import random
from datetime import date, timedelta
from typing import Tuple

from faker.typing import SexLiteral
from .. import Provider as PassportProvider


class Provider(PassportProvider):
    """Implement passport provider for ``pa_AF`` locale."""

    # Afghan passport number formats
    passport_number_formats = (
        "A########",  # alphanumeric starting with A
        "P########",  # alphanumeric starting with P
        "########",  # numeric only
        "###-######",  # formatted with dash
    )

    # Afghan first names in Pashto
    first_names = {
        "M": [
            'احمد', 'محمد', 'عبدالله', 'نورالله', 'خالد', 'رحیم', 'فرید', 'ناصر', 'جمال', 'طارق',
            'ولي', 'یوسف', 'ظاهر', 'بشیر', 'داود', 'فیصل', 'گل', 'حمید', 'اسماعیل', 'جاوید',
            'کریم', 'لطیف', 'مسعود', 'نور', 'عمر', 'قادر', 'رشید', 'صافی', 'طالب', 'واحد',
            'بریالی', 'سپین', 'تور', 'زمرد', 'خوستی', 'وزیر', 'میران', 'سنجر', 'شینواری', 'غلجی',
            'امان‌الله', 'عزیز', 'بشیر', 'داوود', 'احسان', 'فهیم', 'غلام', 'حبیب', 'ابراهیم', 'جلال',
            'کبیر', 'لطف‌الله', 'منصور', 'نعیم', 'عبید', 'پاچا', 'قیس', 'رحمت', 'ستار', 'تواب',
            'عمر', 'ولي', 'ویس', 'یعقوب', 'ذبی', 'عبدال', 'عطاالله', 'بسم‌الله', 'چمن', 'دستگیر',
            'عزت', 'فروز', 'غوث', 'حافظ', 'عنایت', 'جهان', 'خلیل', 'لال', 'متین', 'نظر',
            'عمر', 'پیر', 'قربان', 'رحیم', 'سامی', 'طاهر', 'عبید', 'وکیل', 'ولي', 'یار',
            'زمان', 'امین', 'باز', 'چنار', 'دلور', 'احسان‌الله', 'فضل', 'گلزار', 'حاجی', 'الیاس',
            'جمعه', 'خال', 'لاله', 'ملا', 'نیک', 'امید', 'پاچا', 'قادر', 'رحمن', 'صادق',
            'طالب', 'استاد', 'وفادار', 'وزیر', 'یونس', 'زبیر', 'عاشق', 'بدر', 'چراغ', 'دریا',
            'عید', 'فیض', 'گوهر', 'حکیم', 'اقبال', 'جمیل', 'خان', 'لیاقت', 'مؤمن', 'نواب',
            'عبیدالله', 'پیمان', 'قاسم', 'رفیق', 'صاحب', 'تاج', 'عثمان', 'وکیل', 'وطن', 'یفتلی',
            'زرداد', 'اسد', 'بهرام', 'چمن', 'دوست', 'ایباد', 'فتح', 'غوث‌الدین', 'هدایت', 'اسحاق',
            'جواد', 'کمال', 'لطف', 'میران', 'نور', 'عبید', 'پرویز', 'قدرت', 'رحیم‌الله', 'صابر',
            'توفیق', 'عمر', 'وداد', 'وهاب', 'یحیی', 'زلمی', 'ایمل', 'بابر', 'چنار', 'دل',
            'ایمل', 'فرهاد', 'گلب‌الدین', 'حاجی', 'عرفان', 'جهانگیر', 'خالد', 'لال', 'میران', 'نیک',
            'عمر', 'پاچا', 'قیس', 'رحمت‌الله', 'ساحل', 'طاهر', 'عبیدالله', 'وسیف', 'ولي‌الله', 'یحیی',
            'زکی', 'عارف', 'بلال', 'چمن‌الله', 'داود', 'احسان', 'فضل‌الله', 'گل', 'حکیم', 'ابراهیم',
            'جمشید', 'خلیل‌الله', 'لطیف‌الله', 'مؤمن', 'نظیر', 'عبید', 'پیر', 'قربان', 'رحیم', 'سامی‌الله',
            'تاج‌الدین', 'عثمان', 'وکیل', 'وارث', 'یاسین', 'ذبیح', 'اسلم', 'بسم‌الله', 'چراغ', 'دلور',
        ],
        "F": [
            'مریم', 'فاطمه', 'زهرا', 'لیلی', 'نادیه', 'صبرینه', 'ثریا', 'پروین', 'شکریه', 'فرشته',
            'هادیه', 'جمیله', 'کمیلہ', 'نرگس', 'رضیه', 'صافیه', 'تمنّا', 'وجیهه', 'یاسمین', 'زرمنه',
            'گل‌الای', 'میرمن', 'سپین‌گل', 'تور‌پیکۍ', 'وږمه', 'شمسیه', 'نغمه', 'مشعل', 'سنگه', 'زرغونه',
            'عایشه', 'بی‌بی', 'چمن', 'دل‌افروز', 'ایمان', 'فرحناز', 'گل', 'هدیه', 'ارم', 'جهان‌آرا',
            'خدیجه', 'لال‌زری', 'مهناز', 'نبیله', 'عذرا', 'پروانه', 'قمر', 'رحیله', 'سحر', 'تبسم',
            'عظمی', 'ویدا', 'وحیده', 'یلدا', 'زینب', 'افسانه', 'بخت', 'چمن', 'دردانه', 'ارم',
            'فوزیه', 'گلشن', 'حوا', 'عفت', 'جمیله', 'کلثوم', 'لیلی', 'معصومه', 'نجیبه', 'عمره',
            'پلوشه', 'قُبره', 'رحیمه', 'سکینه', 'طاهره', 'عروج', 'ویدا', 'وجمه', 'یاسره', 'زرقه',
            'عقیلہ', 'بشری', 'چنار', 'دل‌ربا', 'ایشل', 'فریال', 'گلنار', 'هینا', 'عنایت', 'جوهره',
            'کاوش', 'لمر', 'منیره', 'نسرین', 'امید', 'پریسا', 'قدسیه', 'رضیه', 'صدف', 'تسلیمه',
            'امیره', 'وسیلہ', 'وزیره', 'یمنه', 'ذبیحه', 'انیسه', 'بهر', 'چین', 'دریا', 'الهام',
            'فرخنده', 'گلرخ', 'هرا', 'اقراء', 'جوید', 'کیران', 'لیلما', 'مهره', 'نازیه', 'اورانه',
            'پری', 'قرأت', 'رحمت', 'صائمه', 'طاهره', 'عظمی', 'ویدا', 'ورثه', 'یاسمین', 'ذولفقه',
            'عروج', 'بانو', 'چمن‌آرا', 'دلشاد', 'ایمان', 'فرزانه', 'گلبانو', 'هما', 'ارم', 'جنت',
            'کشمله', 'لیلی', 'مهوش', 'نرگس', 'امیمه', 'پیمان', 'قمریه', 'روشنه', 'صغری', 'تارا',
            'علفت', 'ویدا', 'وحیده', 'یاسمین', 'زاره', 'عالیه', 'بهر', 'چمن', 'دلبر', 'ایما',
            'فهیمه', 'گلبهار', 'هینه', 'ارم', 'جویریه', 'خالده', 'لیلی', 'مهیره', 'نسیم', 'امیده',
            'پری‌زاد', 'قدسیه', 'رخساره', 'صبا', 'تسنیم', 'عروسه', 'وسیمه', 'وجدان', 'یاسمین', 'زارین',
            'امینہ', 'بی‌بی', 'چمن', 'دردانه', 'ارم', 'فوزیه', 'گل', 'حوا', 'عفت', 'جمیله',
        ]
    }

    # Afghan last names in Pashto
    last_names = [
        'خان', 'احمدزی', 'محمدی', 'کریمی', 'حسینی', 'رحمانی', 'صدیقی', 'یوسفزی', 'پوپل', 'غلجی',
        'درانی', 'بارکزی', 'نوری', 'الکزایی', 'ستانیکزی', 'زازی', 'وردک', 'خروټی', 'هوتک', 'ترکی',
        'احمدی', 'علمی', 'بلخی', 'دانش', 'ابراهیمی', 'فاروقی', 'غني', 'حکیمی', 'ابراهیمی', 'جامی',
        'ارسلایی', 'اطمار', 'عزیزی', 'بختیاری', 'چرخی', 'دوست', 'احساس', 'فقیری', 'گل', 'حیدری',
        'اسماعیل', 'جبارخیل', 'کاکړ', 'لودین', 'منگل', 'نیازی', 'عمر', 'پکتین', 'قادری', 'رسولی',
        'صافی', 'تنی', 'عمر', 'وفا', 'یفتلی', 'زدران', 'اچکزایی', 'ببرکزایی', 'چمکنی', 'دولتزی',
        'عصمت', 'فهیم', 'غافور', 'حبیبی', 'اسحاقزی', 'جلالزی', 'کندهاری', 'لاکنوال', 'محمود', 'نظر',
        'عبیدالله', 'پروانی', 'قیس‌رانی', 'روحانی', 'سنگین', 'ترکی', 'عثمانی', 'وزیری', 'یعقوبی', 'زابلی',
        'افریدی', 'بنګش', 'چترالی', 'داوودزی', 'عید', 'فاروق', 'غالب', 'حسینزی', 'ابراهیم‌خیل', 'جلال‌آباد',
        'ختک', 'لشکری', 'مروت', 'ننګرهار', 'اورکزئی', 'پشاوری', 'قندهاری', 'رحیم', 'شینواری', 'توری',
        'عثمانزی', 'وزیر', 'یوسف', 'زاخیل', 'امین', 'بابر', 'چمن', 'داود', 'عیدگاه', 'فاروق',
        'غزنی', 'حبیب‌الله', 'الیاس', 'جمال', 'خلیل', 'لطیف', 'میران', 'نیک', 'عبید', 'پاچا',
        'قیس', 'رحیم‌الله', 'صاحب', 'تاج', 'عبید', 'وکیل', 'ولي', 'یار', 'زمان', 'امین‌الله',
        'باز', 'چنار', 'دلور', 'احسان‌الله', 'فضل', 'گلزار', 'حاجی', 'الیاس', 'جمعه', 'خال',
        'لاله', 'ملا', 'نیک', 'امید', 'پاچا', 'قادر', 'رحمن', 'صادق', 'طالب', 'استاد',
        'وفادار', 'وزیر', 'یونس', 'زبیر', 'عاشق', 'بدر', 'چراغ', 'دریا', 'عید', 'فیض',
        'گوهر', 'حکیم', 'اقبال', 'جمیل', 'خان', 'لیاقت', 'مؤمن', 'نواب', 'عبیدالله', 'پیمان',
        'قاسم', 'رفیق', 'صاحب', 'تاج', 'عثمان', 'وکیل', 'وطن', 'یفتلی', 'زرداد', 'اسد',
        'بهرام', 'چمن', 'دوست', 'ایباد', 'فتح', 'غوث‌الدین', 'هدایت', 'اسحاق', 'جواد', 'کمال',
        'لطف', 'میران', 'نور', 'عبید', 'پرویز', 'قدرت', 'رحیم‌الله', 'صابر', 'توفیق', 'عمر',
        'وداد', 'وهاب', 'یحیی', 'زلمی', 'ایمل', 'بابر', 'چنار', 'دل', 'ایمل', 'فرهاد',
        'گلب‌الدین', 'حاجی', 'عرفان', 'جهانگیر', 'خالد', 'لال', 'میران', 'نیک', 'عمر', 'پاچا',
        'قیس', 'رحمت‌الله', 'ساحل', 'طاهر', 'عبیدالله', 'وسیف', 'ولي‌الله', 'یحیی', 'زکی', 'عارف',
        'بلال', 'چمن‌الله', 'داود', 'احسان', 'فضل‌الله', 'گل', 'حکیم', 'ابراهیم', 'جمشید', 'خلیل‌الله',
        'لطیف‌الله', 'مؤمن', 'نظیر', 'عبید', 'پیر', 'قربان', 'رحیم', 'سامی‌الله', 'تاج‌الدین', 'عثمان',
        'وکیل', 'وارث', 'یاسین', 'ذبیح', 'اسلم', 'بسم‌الله', 'چراغ', 'دلور',
    ]

    def passport_owner(self, gender: SexLiteral = "M") -> Tuple[str, str]:
        first_name = random.choice(self.first_names.get(gender, self.first_names["M"]))
        last_name = random.choice(self.last_names)
        return first_name, last_name

    def passport_dates(self, birthday: date = date.today()) -> Tuple[date, date]:
        """Generate issue and expiry dates for Afghan passport."""
        today = date.today()
        age = today.year - birthday.year - ((today.month, today.day) < (birthday.month, birthday.day))

        if age < 5:
            expiry_years = 5
            issue_date = self.generator.date_between_dates(birthday, today)
        elif age < 16:
            expiry_years = 5
            min_issue = birthday + timedelta(days=5 * 365)
            issue_date = self.generator.date_between_dates(min_issue, today)
        elif age >= 26:
            expiry_years = 10
            min_issue = today - timedelta(days=expiry_years * 365)
            issue_date = self.generator.date_between_dates(min_issue, today)
        else:
            expiry_years = 26 - age
            min_issue = birthday + timedelta(days=16 * 365)
            issue_date = self.generator.date_between_dates(min_issue, today)

        expiry_date = issue_date.replace(year=issue_date.year + expiry_years)

        # Adjust Feb 29 for non-leap years
        if issue_date.month == 2 and issue_date.day == 29:
            if not self._is_leap_year(expiry_date.year):
                expiry_date = expiry_date.replace(day=28)

        return issue_date, expiry_date

    def _is_leap_year(self, year: int) -> bool:
        return year % 4 == 0 and (year % 100 != 0 or year % 400 == 0)

    def passport_gender(self, seed: int = 0) -> SexLiteral:
        if seed != 0:
            random.seed(seed)
        genders: list[SexLiteral] = ["M", "F", "X"]
        return random.choices(genders, weights=[0.493, 0.493, 0.014], k=1)[0]